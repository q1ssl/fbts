[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Checkin",
  "enabled": 1,
  "modified": "2025-08-30 00:06:34.472251",
  "module": "fbts",
  "name": "Employee Checkin",
  "script": "frappe.ui.form.on('Employee Checkin', {\n    onload(frm) {\n        frappe.realtime.on('refresh_checkin_form', (data) => {\n            if (data.name === frm.doc.name) {\n                frm.reload_doc();  // Refresh only if it's the current doc\n            }\n        });\n    }\n});\n\n\n\n\n\n\n\n\n\n\n\n// frappe.ui.form.on('Employee Checkin', {\n//     after_save: function(frm) {\n//         frappe.call({\n//             method: \"fbts.api.regularise.apply_regularise_time\",\n//             type: \"POST\",\n//             args: {\n//                 name: frm.doc.name,\n//                 custom_status: frm.doc.custom_status\n//             },\n//             callback: function(r) {\n//                 if (!r.exc) {\n//                     frappe.msgprint(\"Status synced.\");\n//                     frm.reload_doc(); // Reload the form after API call\n//                 }\n//             }\n//         });\n//     }\n// });\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Offer",
  "enabled": 1,
  "modified": "2025-09-01 23:40:11.007052",
  "module": "fbts",
  "name": "Job Offer",
  "script": "frappe.ui.form.on('Job Offer', {\n    on_submit: function(frm) {\n        if (frm.doc.custom_create_user == 1) {\n            frappe.call({\n                method: \"frappe.client.insert\",\n                args: {\n                    doc: {\n                        doctype: \"User\",\n                        email: frm.doc.applicant_email,\n                        first_name: frm.doc.applicant_name,\n                        enabled: 1,\n                        new_password: \"fbts@123\"\n                    }\n                },\n                callback: function(r) {\n                    if (!r.exc) {\n                        frappe.msgprint(__('User created: ' + r.message.name));\n                    }\n                }\n            });\n        }\n    },\n    \n    custom_ctc: function(frm) {\n        amount_in_word(frm);\n    },\n    custom_ctc_template(frm) {\n    populate_from_ctc_template(frm);\n  },\n  onload(frm) {\n    if (frm.doc.custom_ctc_template) populate_from_ctc_template(frm);\n  }\n});\n\n\nfunction amount_in_word(frm) {\n    if (frm.doc.custom_ctc) {\n        frappe.call({\n            method: \"fbts.amount_in_words.get_money_in_words\",\n            args: {\n                amount: frm.doc.custom_ctc\n            },\n            callback: function(r) {\n                if (r.message) {\n                    frm.set_value(\"custom_total_in_words_inr\", r.message);\n                }\n            }\n        });\n    } else {\n        frm.set_value(\"custom_total_in_words_inr\", \"\");\n    }\n}\n\n\n\n\n\nfunction populate_from_ctc_template(frm) {\n  const template_name = frm.doc.custom_ctc_template;\n\n  if (!template_name) {\n    clear_all(frm);\n    return;\n  }\n\n  const requested_template = template_name; // stale guard\n\n  frappe.call({\n    method: \"frappe.client.get\",\n    args: {\n      doctype: \"CTC Template\",   // your doctype name\n      name: requested_template,  // e.g., \"720000\"\n    },\n    freeze: true,\n    freeze_message: __(\"Loading CTC template...\"),\n    callback: (r) => {\n      if (frm.doc.custom_ctc_template !== requested_template) return;\n      if (!r.message) return;\n\n      const tpl = r.message || {};\n\n      // ----- Earnings -----\n      clear_table(frm, \"custom_earnings\");\n      (tpl.earnings || []).forEach((row) => {\n        const child = frm.add_child(\"custom_earnings\");\n        child.earnings = row.earnings || \"\";\n        child.amount   = flt(row.amount);\n      });\n      frm.refresh_field(\"custom_earnings\");\n\n      // ----- Employer Contributions -----\n      clear_table(frm, \"custom_employer_contribution\");\n      (tpl.employer_contribution || []).forEach((row) => {\n        const child = frm.add_child(\"custom_employer_contribution\");\n        child.employer_contribution = row.employer_contribution || \"\";\n        child.amount = flt(row.amount);\n      });\n      frm.refresh_field(\"custom_employer_contribution\");\n\n      // ----- Deductions -----\n      clear_table(frm, \"custom_deductions\");\n      (tpl.deductions || []).forEach((row) => {\n        const child = frm.add_child(\"custom_deductions\");\n        child.deductions = row.deductions || \"\";\n        child.amount = flt(row.amount);\n      });\n      frm.refresh_field(\"custom_deductions\");\n    },\n    error: () => {\n      clear_all(frm);\n    }\n  });\n}\n\nfunction clear_all(frm) {\n  clear_table(frm, \"custom_earnings\");\n  clear_table(frm, \"custom_employer_contribution\");\n  clear_table(frm, \"custom_deductions\");\n}\n\nfunction clear_table(frm, fieldname) {\n  frm.clear_table(fieldname);\n  frm.refresh_field(fieldname);\n}\n\nfunction flt(val) {\n  const n = parseFloat(val);\n  return isNaN(n) ? 0 : n;\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
  "view": "Form"
 }
]